<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Form</title>
    <link rel="stylesheet" href="styles.scss" />
    <link href="https://fonts.googleapis.com/css?family=Rubik:400,500,700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <header id="menu">
      <div id="mobil-header">
        <img src="static/Backgrounds/burger menu.svg" alt="burgermenu" />
        <a href="index.html"><img id="logo1" src="static/Backgrounds/Logo.svg" alt="logo"/></a>
        <div id="ikkeses"></div>
      </div>
      <div id="pc-header">
        <ul>
          <a href="index.html"> <img id="logo2" src="static/Backgrounds/Logo.svg" alt="logo"/></a>
          <li>About us</li>
          <li>News</li>
          <li>Weekly chart</li>
        </ul>
      </div>
    </header>

    <form id="signup">
      <div class="firstrow">
        <div class="inputcontainer">
          <input name="firstname" type="text" placeholder="&nbsp;" required pattern="[A-Za-z]+" />
          <span class="help1 help-text hide_help"></span>
          <label id="L1" for="firstname">First name</label>
        </div>
        <div class="inputcontainer">
          <input name="lastname" type="text" placeholder="&nbsp;" required autofocus pattern="[A-Za-z]+" />
          <span class="help2 help-text hide_help"></span>
          <label id="L2">Last name</label>
        </div>
        <div class="inputcontainer">
          <input name="username" type="text" placeholder="&nbsp;" pattern="[A-Za-z0-9_]{1,15}" required />
          <span class="help3 help-text hide_help"></span>
          <label id="L3">Username</label>
        </div>
        <div class="inputcontainer">
          <input name="password" type="password" placeholder="&nbsp;" required pattern="^(?=.*[a-zA-Z])(?=\w*[0-9])\w{6,12}$" />
          <span class="help4 help-text hide_help"></span>
          <label id="L4">Password</label>
        </div>
        <div class="inputcontainer">
          <input
            name="passwordconfirm"
            type="password"
            placeholder="&nbsp;"
            required
            pattern="^(?=.*[a-zA-Z])(?=\w*[0-9])\w{6,12}$"
          />
          <span class="help5 help-text hide_help"></span>
          <label id="L5">Confirm password</label>
        </div>
      </div>
      <div class="secondrow">
        <div class="inputcontainer">
          <input name="email" type="email" placeholder="&nbsp;" required />
          <span class="help6 help-text hide_help"></span>
          <label id="L6">E-mail</label>
        </div>
        <div class="inputcontainer">
          <input name="adress" type="text" placeholder="&nbsp;" required class="form-field" />
          <span class="help7 help-text hide_help"></span>
          <label id="L7">Address</label>
        </div>
        <div class="inputcontainer">
          <input name="zipcode" type="text" placeholder="&nbsp;" required maxlength="4" minlength="4" size="4" pattern="[0-9]*" />
          <span class="help8 help-text hide_help"></span>
          <label id="L8">Zip Code</label>
        </div>
        <div class="inputcontainer">
          <input name="city" type="text" placeholder="&nbsp;" required />
          <span class="help9 help-text hide_help"></span>
          <label id="L9">City</label>
        </div>
        <div class="inputcontainer">
          <input name="phone" type="tel" pattern="[0-9]*" minlength="8" maxlength="8" placeholder="&nbsp;" required />
          <span class="help10 help-text hide_help"></span>
          <label id="L10">Phone</label>
        </div>
      </div>
      <button id="submit" disabled>Register</button>
    </form>
  </body>

  <script>
    document.querySelector("input[name='firstname']").value = document.querySelector("input[name='firstname']").value;

    const form = document.querySelector("#signup");
    const formfield = document.querySelectorAll("input");

    form.setAttribute("novalidate", true);

    formfield.forEach(formfield => {
      formfield.addEventListener("blur", checkValidity);
    });

    function checkValidity() {
      let firstNameValidity = document.querySelector("input[name='firstname']").checkValidity();
      let lastNameValidity = document.querySelector("input[name='lastname']").checkValidity();
      let passwordValidity = document.querySelector("input[name='password']").checkValidity();
      let passwordconfirmValidity = passwordMatch();
      let passwordconfirmValid = document.querySelector("input[name='passwordconfirm']").checkValidity();
      let usernameValidity = document.querySelector("input[name='username']").checkValidity();
      let adressValidity = document.querySelector("input[name='adress']").checkValidity();
      let zipcodeValidity = document.querySelector("input[name='zipcode']").checkValidity();
      let cityValidity = document.querySelector("input[name='city']").checkValidity();
      let emailValidity = document.querySelector("input[name='email']").checkValidity();
      let phoneValidity = document.querySelector("input[name='phone']").checkValidity();

      if (
        firstNameValidity === true &&
        lastNameValidity === true &&
        passwordValidity === true &&
        passwordconfirmValidity === true &&
        usernameValidity === true &&
        adressValidity === true &&
        zipcodeValidity === true &&
        cityValidity === true &&
        emailValidity === true &&
        phoneValidity === true
      ) {
        document.querySelector("#submit").removeAttribute("disabled");
        document.querySelector("#submit").style.transition = "1s";
        document.querySelector("#submit").style.borderRadius = "7px";
        document.querySelector("#submit").style.backgroundColor = "#fff";
        console.log("Valid");
      } else {
        console.log("Invalid");
        document.querySelector("#submit").disabled = "true";
      }
    }

    document.querySelector("input[name='firstname']").addEventListener("blur", () => {
      let firstNameValidity = document.querySelector("input[name='firstname']").checkValidity();
      if (firstNameValidity === false) {
        document.querySelector(".help1").classList.remove("hide_help");
        document.querySelector("#L1").classList.add("invalid_state");
      } else {
        document.querySelector(".help1").classList.add("hide_help");
        document.querySelector("#L1").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='lastname']").addEventListener("blur", () => {
      let lastNameValidity = document.querySelector("input[name='lastname']").checkValidity();
      if (lastNameValidity === false) {
        document.querySelector(".help2").classList.remove("hide_help");
        document.querySelector("#L2").classList.add("invalid_state");
      } else {
        document.querySelector(".help2").classList.add("hide_help");
        document.querySelector("#L2").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='username']").addEventListener("blur", () => {
      let usernameValidity = document.querySelector("input[name='username']").checkValidity();
      if (usernameValidity === false) {
        document.querySelector(".help3").classList.remove("hide_help");
        document.querySelector("#L3").classList.add("invalid_state");
      } else {
        document.querySelector(".help3").classList.add("hide_help");
        document.querySelector("#L3").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='password']").addEventListener("blur", () => {
      let passwordValidity = document.querySelector("input[name='password']").checkValidity();
      if (passwordValidity === false) {
        document.querySelector(".help4").classList.remove("hide_help");
        document.querySelector("#L4").classList.add("invalid_state");
      } else {
        document.querySelector(".help4").classList.add("hide_help");
        document.querySelector("#L4").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='passwordconfirm']").addEventListener("blur", () => {
      let passwordValid = document.querySelector("input[name='passwordconfirm']").checkValidity();
      if (passwordValid === false) {
        document.querySelector(".help5").classList.remove("hide_help");
        document.querySelector("#L5").classList.add("invalid_state");
      } else {
        document.querySelector(".help5").classList.add("hide_help");
        document.querySelector("#L5").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='email']").addEventListener("blur", () => {
      let emailValidity = document.querySelector("input[name='email']").checkValidity();
      if (emailValidity === false) {
        document.querySelector(".help6").classList.remove("hide_help");
        document.querySelector("#L6").classList.add("invalid_state");
      } else {
        document.querySelector(".help6").classList.add("hide_help");
        document.querySelector("#L6").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='adress']").addEventListener("blur", () => {
      let adressValidity = document.querySelector("input[name='adress']").checkValidity();
      if (adressValidity === false) {
        document.querySelector(".help7").classList.remove("hide_help");
        document.querySelector("#L7").classList.add("invalid_state");
      } else {
        document.querySelector(".help7").classList.add("hide_help");
        document.querySelector("#L7").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='zipcode']").addEventListener("blur", () => {
      let zipcodeValidity = document.querySelector("input[name='zipcode']").checkValidity();
      if (zipcodeValidity === false) {
        document.querySelector(".help8").classList.remove("hide_help");
        document.querySelector("#L8").classList.add("invalid_state");
      } else {
        document.querySelector(".help8").classList.add("hide_help");
        document.querySelector("#L8").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='city']").addEventListener("blur", () => {
      let cityValidity = document.querySelector("input[name='city']").checkValidity();
      if (cityValidity === false) {
        document.querySelector(".help9").classList.remove("hide_help");
        document.querySelector("#L9").classList.add("invalid_state");
      } else {
        document.querySelector(".help9").classList.add("hide_help");
        document.querySelector("#L9").classList.remove("invalid_state");
      }
    });

    document.querySelector("input[name='phone']").addEventListener("blur", () => {
      let phoneValidity = document.querySelector("input[name='phone']").checkValidity();
      if (phoneValidity === false) {
        document.querySelector(".help10").classList.remove("hide_help");
        document.querySelector("#L10").classList.add("invalid_state");
      } else {
        document.querySelector(".help10").classList.add("hide_help");
        document.querySelector("#L10").classList.remove("invalid_state");
      }
    });

    function passwordMatch() {
      if (
        document.querySelector("input[name='password']").value === document.querySelector("input[name='passwordconfirm']").value
      ) {
        console.log("de matcher");
        return true;
      } else {
        console.log("intet match");
        return false;
      }
    }

    let urlParams = new URLSearchParams(window.location.search);
    let id = urlParams.get("id");
    document.querySelector("input[name='firstname']").value = id;
    // get

    // post

    function post() {
      const data = {
        firstname: "Peter",
        lastname: "Langgkrammerr",
        username: "casinoohajen",
        password: "FlottFyr699",
        email: "flottfyr699@hotmail.com",
        adress: "Lygten 112",
        zipcode: "2901",
        city: "København B",
        phone: "12345666"
      };

      data.firstname = form.elements.firstname.value;
      data.lastname = form.elements.lastname.value;
      data.username = form.elements.username.value;
      data.password = form.elements.password.value;
      data.email = form.elements.email.value;
      data.adress = form.elements.adress.value;
      data.zipcode = form.elements.zipcode.value;
      data.city = form.elements.city.value;
      data.phone = form.elements.phone.value;

      const postData = JSON.stringify(data);
      fetch(`https://coldfriday-37b0.restdb.io/rest/jack21`, {
        method: "post",
        headers: {
          "Content-Type": "application/json; charset=utf-8",
          "x-apikey": "5dee0691bf46220df655d8c4",
          "cache-control": "no-cache"
        },
        body: postData
      })
        .then(res => res.json())
        .then(data => {
          console.log(data);
        });
    }

    document.querySelector("#submit").addEventListener("click", e => {
      console.log("button clicked");
      e.preventDefault();
      post();
    });
  </script>
</html>
